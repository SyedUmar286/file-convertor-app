async function processConversion() {
            const fileInput = document.getElementById('fileInput');
            const targetFormat = document.getElementById('toFormat').value;
            const status = document.getElementById('status');
            const file = fileInput.files[0];

            if (!file) {
                status.style.color = "#cd3d33";
                status.innerText = "Please select a file first!";
                return; 
            }

            status.style.color = "black";
            status.innerText = "Processing...";

            try {
                // --- FIXED HEIC SECTION ---
                if (targetFormat === 'heic' || file.name.toLowerCase().endsWith('.heic')) {
                    const blobData = await heic2any({ 
                        blob: file, 
                        toType: "image/jpeg",
                        quality: 0.7 // Optimized for browser performance
                    });
                    
                    // Handle if library returns an array
                    const finalBlob = Array.isArray(blobData) ? blobData[0] : blobData;
                    downloadBlob(finalBlob, file.name.split('.')[0] + ".jpg");
                } 
                // --- SVG LOGIC (Keeping your working version) ---
                else if (targetFormat === 'svg') {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const svgData = `<svg xmlns="http://www.w3.org/2000/svg" width="800" height="600"><image href="${e.target.result}" width="100%" height="100%"/></svg>`;
                        const svgBlob = new Blob([svgData], {type: 'image/svg+xml;charset=utf-8'});
                        downloadBlob(svgBlob, "converted.svg");
                    };
                    reader.readAsDataURL(file);
                }
                // --- PDF LOGIC ---
                else if (targetFormat === 'pdf') {
                    const pdfDoc = await PDFLib.PDFDocument.create();
                    const imageBytes = await file.arrayBuffer();
                    let embeddedImage;
                    if (file.type === "image/png") {
                        embeddedImage = await pdfDoc.embedPng(imageBytes);
                    } else {
                        embeddedImage = await pdfDoc.embedJpg(imageBytes);
                    }
                    const page = pdfDoc.addPage([embeddedImage.width, embeddedImage.height]);
                    page.drawImage(embeddedImage, { x: 0, y: 0, width: embeddedImage.width, height: embeddedImage.height });
                    const pdfBytes = await pdfDoc.save();
                    downloadBlob(new Blob([pdfBytes], { type: 'application/pdf' }), "converted.pdf");
                } 
                // --- STANDARD IMAGES ---
                else {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const img = new Image();
                        img.onload = () => {
                            const canvas = document.createElement('canvas');
                            canvas.width = img.width; canvas.height = img.height;
                            const ctx = canvas.getContext('2d');
                            ctx.drawImage(img, 0, 0);
                            canvas.toBlob((blob) => {
                                downloadBlob(blob, `converted.${targetFormat}`);
                            }, `image/${targetFormat === 'jpg' ? 'jpeg' : targetFormat}`);
                        };
                        img.src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                }
                status.style.color = "green";
                status.innerText = "Success! Download started.";
            } catch (err) {
                status.style.color = "red";
                status.innerText = "Conversion failed. Please check the file format.";
                console.error("HEIC Error: ", err);
            }
        }
