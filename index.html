async function processConversion() {
            const fileInput = document.getElementById('fileInput');
            const targetFormat = document.getElementById('toFormat').value;
            const status = document.getElementById('status');
            const file = fileInput.files[0];

            if (!file) {
                status.style.color = "#cd3d33";
                status.innerText = "Please select a file first!";
                return; 
            }

            status.style.color = "black";
            status.innerText = "Processing...";

            try {
                // --- SMART HEIC HANDLING ---
                if (targetFormat === 'heic') {
                    // Check if file is already a standard image (The cause of your error)
                    if (file.type === "image/jpeg" || file.type === "image/png") {
                        throw new Error("Cannot convert JPG/PNG to HEIC. HEIC to JPG is supported.");
                    }
                    
                    const blobData = await heic2any({ 
                        blob: file, 
                        toType: "image/jpeg",
                        quality: 0.6 
                    });
                    const finalBlob = Array.isArray(blobData) ? blobData[0] : blobData;
                    downloadBlob(finalBlob, "converted_from_heic.jpg");
                } 
                // --- SVG LOGIC (Verified Working) ---
                else if (targetFormat === 'svg') {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const svgData = `<svg xmlns="http://www.w3.org/2000/svg" width="800" height="600"><image href="${e.target.result}" width="100%" height="100%"/></svg>`;
                        downloadBlob(new Blob([svgData], {type: 'image/svg+xml'}), "converted.svg");
                    };
                    reader.readAsDataURL(file);
                }
                // --- PDF LOGIC (Verified Working) ---
                else if (targetFormat === 'pdf') {
                    const pdfDoc = await PDFLib.PDFDocument.create();
                    const bytes = await file.arrayBuffer();
                    const img = (file.type === "image/png") ? await pdfDoc.embedPng(bytes) : await pdfDoc.embedJpg(bytes);
                    const page = pdfDoc.addPage([img.width, img.height]);
                    page.drawImage(img, { x: 0, y: 0, width: img.width, height: img.height });
                    downloadBlob(new Blob([await pdfDoc.save()]), "converted.pdf");
                }
                // --- ALL OTHER FORMATS ---
                else {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const img = new Image();
                        img.onload = () => {
                            const canvas = document.createElement('canvas');
                            canvas.width = img.width; canvas.height = img.height;
                            canvas.getContext('2d').drawImage(img, 0, 0);
                            canvas.toBlob((blob) => {
                                downloadBlob(blob, `converted.${targetFormat}`);
                            }, `image/${targetFormat === 'jpg' ? 'jpeg' : targetFormat}`);
                        };
                        img.src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                }
                status.style.color = "green";
                status.innerText = "Success! Download started.";
            } catch (err) {
                status.style.color = "red";
                status.innerText = err.message; // Shows the specific safety message
                console.error("Conversion Error:", err);
            }
        }
